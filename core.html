<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biểu Diễn Hiệu Suất Hệ Thống Ngân Hàng Lõi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Đảm bảo container của canvas có kích thước phù hợp */
        .chart-container {
            position: relative; /* Cần thiết cho responsiveness của Chart.js */
            margin: auto;
            height: 300px; /* Đặt chiều cao cố định cho container */
            width: 100%; /* Chiều rộng linh hoạt */
        }
    </style>
</head>
<body class="bg-gray-100 p-6">

    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6 text-gray-800 text-center">Bảng Hiệu Suất Hệ Thống Ngân Hàng Lõi</h2>

        <div class="flex space-x-4 mb-6 justify-center">
            <button id="chart-tab" class="px-6 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out">Biểu đồ</button>
            <button id="table-tab" class="px-6 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 transition duration-150 ease-in-out">Bảng</button>
        </div>

        <div id="utilization-checkbox-container" class="flex items-center mb-6 justify-center">
             <input type="checkbox" id="show-utilization" class="mr-2 form-checkbox text-blue-600 h-5 w-5">
             <label for="show-utilization" class="text-gray-700 text-lg">Hiển thị Tỷ lệ Sử dụng Dung lượng</label>
        </div>


        <div id="chart-view" class="space-y-10">
            <div>
                <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">TPS Tài chính - Thực tế so với Dung lượng</h3>
                <p class="text-sm text-gray-600 mb-4 text-center">
                  TPS Tài chính Thực tế tăng đều từ 200 lên 400, trong khi Dung lượng tăng đáng kể từ 500 lên 4000,
                  cho thấy dung lượng cao hơn nhiều so với nhu cầu thực tế.
                </p>
                <div class="chart-container">
                    <canvas id="tpsFinChart"></canvas>
                </div>
            </div>

            <div id="utilization-chart-container" class="hidden">
                <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">Tỷ lệ Sử dụng Dung lượng TPS Tài chính</h3>
                 <div class="chart-container">
                    <canvas id="utilizationChart"></canvas>
                 </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">TPS Phi tài chính</h3>
                 <p class="text-sm text-gray-600 mb-4 text-center">
                   TPS Phi tài chính giảm dần theo thời gian khi hệ thống được tối ưu hóa, cho phép xử lý hiệu quả hơn với ít tài nguyên hơn.
                   Mức Dung lượng duy trì ổn định ở mức 20,000 TPS.
                 </p>
                 <div class="chart-container">
                    <canvas id="tpsNonFinChart"></canvas>
                 </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">Thời gian xử lý cuối ngày (EOD)</h3>
                <p class="text-sm text-gray-600 mb-4 text-center">
                  Thời gian xử lý EOD giảm đáng kể từ 6 giờ xuống dưới 3 giờ nhờ tối ưu hóa mã nguồn EOD,
                  cải thiện hiệu suất và giảm thời gian xử lý.
                </p>
                 <div class="chart-container">
                    <canvas id="eodChart"></canvas>
                 </div>
            </div>
        </div>

        <div id="table-view" class="hidden">
            <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">Bảng Dữ liệu Hiệu suất</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm border-collapse">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="border border-gray-300 px-4 py-2 text-left">Tên</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">TPS Tài chính TB</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">TPS Phi tài chính</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Dung lượng TPS Phi tài chính</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Dung lượng TPS Tài chính</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">EOD</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Tỷ lệ Sử dụng (%)</th>
                            <th class="border border-gray-300 px-4 py-2 text-left">Tỷ lệ Sử dụng Phi tài chính (%)</th>
                        </tr>
                    </thead>
                    <tbody id="performance-table-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Dữ liệu hiệu suất hệ thống
        const performanceData = [
            { name: 'Golive', tpsFin: 200, tpsNonFin: 10000, tpsFinCapacity: 500, tpsNonFinCapacity: 20000, eod: '6 hours' },
            { name: 'Y1', tpsFin: 300, tpsNonFin: 8000, tpsFinCapacity: 1000, tpsNonFinCapacity: 20000, eod: '4 hours' },
            { name: 'Y2', tpsFin: 400, tpsNonFin: 6000, tpsFinCapacity: 4000, tpsNonFinCapacity: 20000, eod: '< 3 hours' }
        ];

        // Tính toán tỷ lệ sử dụng dung lượng
        const utilizationData = performanceData.map(item => {
            let eodHours;
             if (item.eod === '< 3 hours') {
                eodHours = 2.5; // Ước tính 2.5 giờ cho "< 3 giờ"
            } else {
                eodHours = parseInt(item.eod.split(' ')[0]); // Lấy phần số từ chuỗi "X hours"
            }
            return {
                ...item,
                // Tính tỷ lệ sử dụng TPS Tài chính, làm tròn đến số nguyên gần nhất
                utilizationRate: Math.round((item.tpsFin / item.tpsFinCapacity) * 100),
                // Tính tỷ lệ sử dụng TPS Phi tài chính, làm tròn đến số nguyên gần nhất
                nonFinUtilizationRate: Math.round((item.tpsNonFin / item.tpsNonFinCapacity) * 100),
                // Giá trị số cho biểu đồ EOD
                eodNumeric: eodHours
            };
        });

        let tpsFinChartInstance = null;
        let tpsNonFinChartInstance = null;
        let eodChartInstance = null;
        let utilizationChartInstance = null;

        // Hàm render biểu đồ TPS Tài chính
        function renderTpsFinChart() {
            const ctx = document.getElementById('tpsFinChart').getContext('2d');
            if (tpsFinChartInstance) tpsFinChartInstance.destroy(); // Hủy biểu đồ cũ nếu có
            tpsFinChartInstance = new Chart(ctx, {
                type: 'bar', // Loại biểu đồ cột
                data: {
                    labels: performanceData.map(item => item.name), // Nhãn trục X
                    datasets: [
                        {
                            label: 'TPS Tài chính Thực tế', // Nhãn dataset
                            data: performanceData.map(item => item.tpsFin), // Dữ liệu
                            backgroundColor: 'rgba(75, 192, 192, 0.6)', // Màu nền cột
                            borderColor: 'rgba(75, 192, 192, 1)', // Màu viền cột
                            borderWidth: 1
                        },
                        {
                            label: 'Dung lượng TPS Tài chính', // Nhãn dataset
                            data: performanceData.map(item => item.tpsFinCapacity), // Dữ liệu
                            type: 'line', // Loại biểu đồ đường
                            borderColor: 'rgba(255, 159, 64, 1)', // Màu đường
                            backgroundColor: 'rgba(255, 159, 64, 0.6)', // Màu nền điểm
                            fill: false, // Không tô màu dưới đường
                            tension: 0.1 // Độ cong của đường
                        }
                    ]
                },
                options: {
                    responsive: true, // Biểu đồ đáp ứng
                    maintainAspectRatio: false, // Không duy trì tỷ lệ khung hình, để container quyết định kích thước
                    scales: {
                        y: {
                            beginAtZero: true, // Bắt đầu trục Y từ 0
                            title: { // Tiêu đề trục Y
                                display: true,
                                text: 'Giao dịch mỗi giây'
                            }
                        }
                    },
                    plugins: {
                         tooltip: { // Cấu hình tooltip
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y;
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: { // Cấu hình legend
                            display: true
                        }
                    }
                }
            });
        }

        // Hàm render biểu đồ TPS Phi tài chính
        function renderTpsNonFinChart() {
            const ctx = document.getElementById('tpsNonFinChart').getContext('2d');
            if (tpsNonFinChartInstance) tpsNonFinChartInstance.destroy();
            tpsNonFinChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: performanceData.map(item => item.name),
                    datasets: [
                        {
                            label: 'TPS Phi tài chính Thực tế',
                            data: performanceData.map(item => item.tpsNonFin),
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        },
                         {
                            label: 'Dung lượng TPS Phi tài chính',
                            data: performanceData.map(item => item.tpsNonFinCapacity),
                            type: 'line',
                            borderColor: 'rgba(255, 159, 64, 1)',
                            backgroundColor: 'rgba(255, 159, 64, 0.6)',
                            fill: false,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                             title: {
                                display: true,
                                text: 'Giao dịch mỗi giây'
                            }
                        }
                    },
                     plugins: {
                         tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y;
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            display: true
                        }
                    }
                }
            });
        }

        // Hàm render biểu đồ EOD
        function renderEodChart() {
            const ctx = document.getElementById('eodChart').getContext('2d');
            if (eodChartInstance) eodChartInstance.destroy();
            eodChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: utilizationData.map(item => item.name),
                    datasets: [
                        {
                            label: 'Thời gian xử lý EOD (Giờ)',
                            data: utilizationData.map(item => item.eodNumeric),
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                             title: {
                                display: true,
                                text: 'Giờ'
                            }
                        }
                    },
                     plugins: {
                         tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + ' giờ';
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            display: true
                        }
                    }
                }
            });
        }

        // Hàm render biểu đồ Tỷ lệ Sử dụng Dung lượng
        function renderUtilizationChart() {
             const ctx = document.getElementById('utilizationChart').getContext('2d');
             if (utilizationChartInstance) utilizationChartInstance.destroy();
             utilizationChartInstance = new Chart(ctx, {
                 type: 'bar',
                 data: {
                     labels: utilizationData.map(item => item.name),
                     datasets: [
                         {
                             label: 'Tỷ lệ Sử dụng Dung lượng TPS Tài chính (%)',
                             data: utilizationData.map(item => item.utilizationRate),
                             backgroundColor: 'rgba(153, 102, 255, 0.6)',
                             borderColor: 'rgba(153, 102, 255, 1)',
                             borderWidth: 1
                         },
                          {
                             label: 'Tỷ lệ Sử dụng Dung lượng TPS Phi tài chính (%)',
                             data: utilizationData.map(item => item.nonFinUtilizationRate),
                             backgroundColor: 'rgba(201, 203, 207, 0.6)',
                             borderColor: 'rgba(201, 203, 207, 1)',
                             borderWidth: 1
                         }
                     ]
                 },
                 options: {
                     responsive: true,
                     maintainAspectRatio: false,
                     scales: {
                         y: {
                             beginAtZero: true,
                             max: 100, // Giới hạn trục Y đến 100%
                             title: {
                                 display: true,
                                 text: 'Tỷ lệ (%)'
                             }
                         }
                     },
                     plugins: {
                         tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + '%';
                                    }
                                    return label;
                                }
                            }
                        },
                         legend: {
                             display: true
                         }
                     }
                 }
             });
         }


        // Hàm render bảng dữ liệu
        function renderDataTable() {
            const tableBody = document.getElementById('performance-table-body');
            tableBody.innerHTML = ''; // Xóa nội dung cũ của bảng
            utilizationData.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50'; // Đổi màu nền hàng
                tr.innerHTML = `
                    <td class="border border-gray-300 px-4 py-2">${row.name}</td>
                    <td class="border border-gray-300 px-4 py-2">${row.tpsFin}</td>
                    <td class="border border-gray-300 px-4 py-2">${row.tpsNonFin}</td>
                    <td class="border border-gray-300 px-4 py-2">${row.tpsNonFinCapacity}</td>
                    <td class="border border-gray-300 px-4 py-2">${row.tpsFinCapacity}</td>
                    <td class="border border-gray-300 px-4 py-2">${row.eod}</td>
                    <td class="border border-gray-300 px-4 py-2">${row.utilizationRate}%</td>
                    <td class="border border-gray-300 px-4 py-2">${row.nonFinUtilizationRate}%</td>
                `;
                tableBody.appendChild(tr); // Thêm hàng vào bảng
            });
        }

        // Hàm hiển thị chế độ xem (Biểu đồ hoặc Bảng)
        function showView(viewId) {
            document.getElementById('chart-view').classList.add('hidden');
            document.getElementById('table-view').classList.add('hidden');
            document.getElementById('utilization-checkbox-container').classList.add('hidden'); // Ẩn checkbox theo mặc định

            // Xóa tất cả các instance biểu đồ hiện có trước khi hiển thị chế độ xem mới
            if (tpsFinChartInstance) tpsFinChartInstance.destroy();
            if (tpsNonFinChartInstance) tpsNonFinChartInstance.destroy();
            if (eodChartInstance) eodChartInstance.destroy();
            if (utilizationChartInstance) utilizationChartInstance.destroy();


            if (viewId === 'chart-view') {
                document.getElementById('chart-view').classList.remove('hidden');
                document.getElementById('utilization-checkbox-container').classList.remove('hidden'); // Hiển thị checkbox trong chế độ Biểu đồ
                renderCharts(); // Render lại biểu đồ khi chuyển sang chế độ Biểu đồ
            } else {
                document.getElementById('table-view').classList.remove('hidden');
                renderDataTable(); // Render bảng khi chuyển sang chế độ Bảng
            }
        }

        // Hàm render tất cả biểu đồ (hoặc chỉ những biểu đồ cần thiết)
        function renderCharts() {
            renderTpsFinChart();
            renderTpsNonFinChart();
            renderEodChart();
            // Chỉ render biểu đồ Tỷ lệ Sử dụng nếu checkbox được chọn
            if (document.getElementById('show-utilization').checked) {
                 document.getElementById('utilization-chart-container').classList.remove('hidden');
                 renderUtilizationChart();
            } else {
                 document.getElementById('utilization-chart-container').classList.add('hidden');
                 if (utilizationChartInstance) utilizationChartInstance.destroy(); // Hủy biểu đồ nếu ẩn
            }
        }

        // Thêm trình nghe sự kiện cho các nút chuyển đổi tab
        document.getElementById('chart-tab').addEventListener('click', () => showView('chart-view'));
        document.getElementById('table-tab').addEventListener('click', () => showView('table-view'));

        // Thêm trình nghe sự kiện cho checkbox Tỷ lệ Sử dụng
        document.getElementById('show-utilization').addEventListener('change', renderCharts);


        // Hiển thị chế độ xem biểu đồ khi trang được tải
        document.addEventListener('DOMContentLoaded', () => {
            showView('chart-view');
        });

         // Thêm trình nghe sự kiện resize để cập nhật biểu đồ khi kích thước cửa sổ thay đổi
        window.addEventListener('resize', () => {
            // Hủy các biểu đồ hiện có để Chart.js vẽ lại với kích thước mới
            if (tpsFinChartInstance) tpsFinChartInstance.destroy();
            if (tpsNonFinChartInstance) tpsNonFinChartInstance.destroy();
            if (eodChartInstance) eodChartInstance.destroy();
            if (utilizationChartInstance) utilizationChartInstance.destroy();
            // Render lại biểu đồ
            renderCharts();
        });


    </script>

</body>
</html>
